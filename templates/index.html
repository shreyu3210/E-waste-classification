<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Waste Classifier</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #0a0a0f;
        --surface: #12121a;
        --surface2: #1a1a26;
        --border: #2a2a3a;
        --text: #e4e4ed;
        --text-dim: #8888a0;
        --accent: #6c63ff;
        --accent-glow: rgba(108, 99, 255, 0.25);
        --danger: #ef4444;
        --success: #10b981;
        --radius: 16px;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* ‚îÄ‚îÄ Animated background ‚îÄ‚îÄ */
      body::before {
        content: "";
        position: fixed;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background:
          radial-gradient(
            ellipse at 20% 50%,
            rgba(108, 99, 255, 0.06) 0%,
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 20%,
            rgba(236, 72, 153, 0.04) 0%,
            transparent 50%
          ),
          radial-gradient(
            ellipse at 60% 80%,
            rgba(16, 185, 129, 0.04) 0%,
            transparent 50%
          );
        animation: drift 20s ease-in-out infinite alternate;
        z-index: 0;
        pointer-events: none;
      }
      @keyframes drift {
        0% {
          transform: translate(0, 0) rotate(0deg);
        }
        100% {
          transform: translate(-3%, 2%) rotate(3deg);
        }
      }

      /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
      .header {
        position: relative;
        z-index: 1;
        text-align: center;
        padding: 48px 20px 24px;
      }
      .header h1 {
        font-size: 2.4rem;
        font-weight: 800;
        background: linear-gradient(135deg, #6c63ff, #ec4899, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
      }
      .header p {
        color: var(--text-dim);
        font-size: 0.95rem;
        margin-top: 8px;
      }

      /* ‚îÄ‚îÄ Main layout ‚îÄ‚îÄ */
      .container {
        position: relative;
        z-index: 1;
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 20px 60px;
      }

      /* ‚îÄ‚îÄ Tab switcher ‚îÄ‚îÄ */
      .tabs {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 32px;
      }
      .tab-btn {
        padding: 12px 28px;
        border: 1px solid var(--border);
        border-radius: 50px;
        background: var(--surface);
        color: var(--text-dim);
        font-family: inherit;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .tab-btn:hover {
        border-color: var(--accent);
        color: var(--text);
      }
      .tab-btn.active {
        background: var(--accent);
        border-color: var(--accent);
        color: #fff;
        box-shadow: 0 4px 20px var(--accent-glow);
      }

      /* ‚îÄ‚îÄ Panels ‚îÄ‚îÄ */
      .panel {
        display: none;
      }
      .panel.active {
        display: block;
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 32px;
        margin-bottom: 24px;
        transition: border-color 0.3s;
      }
      .card:hover {
        border-color: rgba(108, 99, 255, 0.3);
      }

      /* ‚îÄ‚îÄ Upload area ‚îÄ‚îÄ */
      .upload-zone {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 60px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .upload-zone:hover,
      .upload-zone.dragover {
        border-color: var(--accent);
        background: rgba(108, 99, 255, 0.05);
      }
      .upload-zone .icon {
        font-size: 3rem;
        margin-bottom: 12px;
      }
      .upload-zone h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .upload-zone p {
        color: var(--text-dim);
        font-size: 0.85rem;
      }
      .upload-zone input {
        display: none;
      }

      /* ‚îÄ‚îÄ Preview image ‚îÄ‚îÄ */
      .preview-container {
        display: none;
        justify-content: center;
        margin-top: 20px;
      }
      .preview-container.show {
        display: flex;
      }
      .preview-container img {
        max-width: 400px;
        max-height: 350px;
        border-radius: 12px;
        border: 1px solid var(--border);
        object-fit: contain;
      }

      /* ‚îÄ‚îÄ Webcam ‚îÄ‚îÄ */
      .webcam-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      .webcam-video {
        width: 100%;
        max-width: 560px;
        border-radius: 12px;
        border: 2px solid var(--border);
        background: #000;
      }
      .webcam-controls {
        display: flex;
        gap: 12px;
      }

      /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border: none;
        border-radius: 50px;
        font-family: inherit;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s ease;
      }
      .btn-primary {
        background: linear-gradient(135deg, #6c63ff, #8b5cf6);
        color: #fff;
        box-shadow: 0 4px 15px var(--accent-glow);
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px var(--accent-glow);
      }
      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }
      .btn-outline:hover {
        border-color: var(--accent);
      }
      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: #fff;
      }

      /* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
      .results-card {
        display: none;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 32px;
        margin-top: 24px;
        animation: slideUp 0.4s ease;
      }
      .results-card.show {
        display: block;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-main {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--border);
      }
      .result-emoji {
        font-size: 3.5rem;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: var(--surface2);
        flex-shrink: 0;
      }
      .result-info h2 {
        font-size: 1.6rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .result-info .confidence {
        font-size: 1rem;
        font-weight: 500;
        margin-top: 2px;
      }
      .result-info .desc {
        color: var(--text-dim);
        font-size: 0.85rem;
        margin-top: 6px;
      }

      /* ‚îÄ‚îÄ E-waste alert ‚îÄ‚îÄ */
      .ewaste-alert {
        display: none;
        background: rgba(239, 68, 68, 0.08);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 20px;
        color: #fca5a5;
        font-size: 0.9rem;
        animation: pulse-border 2s ease-in-out infinite;
      }
      .ewaste-alert.show {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .ewaste-alert .alert-icon {
        font-size: 1.5rem;
      }
      @keyframes pulse-border {
        0%,
        100% {
          border-color: rgba(239, 68, 68, 0.3);
        }
        50% {
          border-color: rgba(239, 68, 68, 0.6);
        }
      }

      /* ‚îÄ‚îÄ Bar chart ‚îÄ‚îÄ */
      .top5-title {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-dim);
        margin-bottom: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .bar-row {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 10px;
      }
      .bar-label {
        width: 90px;
        font-size: 0.85rem;
        font-weight: 500;
        text-align: right;
        flex-shrink: 0;
      }
      .bar-track {
        flex: 1;
        height: 28px;
        background: var(--surface2);
        border-radius: 8px;
        overflow: hidden;
        position: relative;
      }
      .bar-fill {
        height: 100%;
        border-radius: 8px;
        transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        position: relative;
      }
      .bar-fill::after {
        content: attr(data-value);
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.75rem;
        font-weight: 600;
        color: #fff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
      }

      /* ‚îÄ‚îÄ Webcam live result overlay ‚îÄ‚îÄ */
      .live-result {
        display: none;
        align-items: center;
        gap: 16px;
        padding: 16px 24px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        min-width: 350px;
        transition: all 0.25s ease;
      }
      .live-result.show {
        display: flex;
      }
      .live-result .live-emoji {
        font-size: 2rem;
      }
      .live-result .live-class {
        font-size: 1.2rem;
        font-weight: 700;
        text-transform: uppercase;
      }
      .live-result .live-conf {
        font-size: 0.9rem;
        color: var(--text-dim);
      }

      /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
      .spinner {
        display: none;
        width: 36px;
        height: 36px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.7s linear infinite;
        margin: 16px auto;
      }
      .spinner.show {
        display: block;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
      @media (max-width: 600px) {
        .header h1 {
          font-size: 1.6rem;
        }
        .card {
          padding: 20px;
        }
        .result-main {
          flex-direction: column;
          text-align: center;
        }
        .bar-label {
          width: 70px;
          font-size: 0.75rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>‚ö° E-Waste Classifier</h1>
      <p>
        AI-powered waste classification ‚Äî Upload an image or use your webcam
      </p>
    </div>

    <div class="container">
      <!-- Tab Switcher -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="upload" id="tab-upload">
          üìÅ Upload Image
        </button>
        <button class="tab-btn" data-tab="webcam" id="tab-webcam">
          üìπ Webcam
        </button>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UPLOAD PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="panel active" id="panel-upload">
        <div class="card">
          <div class="upload-zone" id="upload-zone">
            <div class="icon">üìÅ</div>
            <h3>Drop an image here or click to upload</h3>
            <p>Supports JPG, PNG, WEBP, BMP</p>
            <input type="file" id="file-input" accept="image/*" />
          </div>
          <div class="preview-container" id="preview-container">
            <img id="preview-img" alt="Preview" />
          </div>
          <div style="text-align: center; margin-top: 20px">
            <div class="spinner" id="upload-spinner"></div>
            <button class="btn btn-primary" id="classify-btn" disabled>
              üîç Classify
            </button>
          </div>
        </div>

        <div class="results-card" id="upload-results">
          <div class="ewaste-alert" id="ewaste-alert">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div>
              <strong>E-Waste Detected!</strong><br />
              This item should be disposed of at a certified e-waste recycling
              facility.
            </div>
          </div>
          <div class="result-main">
            <div class="result-emoji" id="result-emoji"></div>
            <div class="result-info">
              <h2 id="result-class"></h2>
              <div class="confidence" id="result-conf"></div>
              <div class="desc" id="result-desc"></div>
            </div>
          </div>
          <div class="top5-title">Top-5 Predictions</div>
          <div id="top5-bars"></div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WEBCAM PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="panel" id="panel-webcam">
        <div class="card">
          <div class="webcam-wrapper">
            <video
              class="webcam-video"
              id="webcam-video"
              autoplay
              playsinline
            ></video>
            <canvas id="webcam-canvas" style="display: none"></canvas>
            <div class="webcam-controls">
              <button class="btn btn-primary" id="start-webcam-btn">
                üìπ Start Webcam
              </button>
              <button
                class="btn btn-danger"
                id="stop-webcam-btn"
                style="display: none"
              >
                ‚èπ Stop
              </button>
            </div>
            <div class="live-result" id="live-result">
              <span class="live-emoji" id="live-emoji"></span>
              <div>
                <div class="live-class" id="live-class"></div>
                <div class="live-conf" id="live-conf"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="results-card" id="webcam-results">
          <div class="ewaste-alert" id="webcam-ewaste-alert">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div>
              <strong>E-Waste Detected!</strong><br />
              This item should be disposed of at a certified e-waste recycling
              facility.
            </div>
          </div>
          <div class="result-main">
            <div class="result-emoji" id="webcam-result-emoji"></div>
            <div class="result-info">
              <h2 id="webcam-result-class"></h2>
              <div class="confidence" id="webcam-result-conf"></div>
              <div class="desc" id="webcam-result-desc"></div>
            </div>
          </div>
          <div class="top5-title">Top-5 Predictions</div>
          <div id="webcam-top5-bars"></div>
        </div>
      </div>
    </div>

    <script>
      // ‚îÄ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".panel")
            .forEach((p) => p.classList.remove("active"));
          btn.classList.add("active");
          document
            .getElementById("panel-" + btn.dataset.tab)
            .classList.add("active");
        });
      });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //   UPLOAD MODE
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const uploadZone = document.getElementById("upload-zone");
      const fileInput = document.getElementById("file-input");
      const previewContainer = document.getElementById("preview-container");
      const previewImg = document.getElementById("preview-img");
      const classifyBtn = document.getElementById("classify-btn");
      const uploadSpinner = document.getElementById("upload-spinner");
      const uploadResults = document.getElementById("upload-results");
      let selectedFile = null;

      uploadZone.addEventListener("click", () => fileInput.click());
      uploadZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadZone.classList.add("dragover");
      });
      uploadZone.addEventListener("dragleave", () =>
        uploadZone.classList.remove("dragover"),
      );
      uploadZone.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadZone.classList.remove("dragover");
        if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
      });
      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length) handleFile(e.target.files[0]);
      });

      function handleFile(file) {
        selectedFile = file;
        const url = URL.createObjectURL(file);
        previewImg.src = url;
        previewContainer.classList.add("show");
        classifyBtn.disabled = false;
        uploadResults.classList.remove("show");
      }

      classifyBtn.addEventListener("click", async () => {
        if (!selectedFile) return;
        classifyBtn.disabled = true;
        uploadSpinner.classList.add("show");
        uploadResults.classList.remove("show");

        const formData = new FormData();
        formData.append("file", selectedFile);

        try {
          const res = await fetch("/predict", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          showResults(data, "upload");
        } catch (err) {
          alert("Error classifying image: " + err.message);
        }

        uploadSpinner.classList.remove("show");
        classifyBtn.disabled = false;
      });

      function showResults(data, prefix) {
        const container = document.getElementById(
          prefix === "upload" ? "upload-results" : "webcam-results",
        );
        const alertEl = document.getElementById(
          prefix === "upload" ? "ewaste-alert" : "webcam-ewaste-alert",
        );

        // Prefix for IDs
        const p = prefix === "upload" ? "" : "webcam-";

        document.getElementById(p + "result-emoji").textContent = data.emoji;
        document.getElementById(p + "result-emoji").style.background =
          `linear-gradient(135deg, ${data.color}22, ${data.color}11)`;
        document.getElementById(p + "result-class").textContent =
          data.prediction;
        document.getElementById(p + "result-class").style.color = data.color;
        document.getElementById(p + "result-conf").textContent =
          `${data.confidence}% confidence`;
        document.getElementById(p + "result-conf").style.color = data.color;
        document.getElementById(p + "result-desc").textContent = data.desc;

        // E-waste alert
        if (data.is_ewaste) {
          alertEl.classList.add("show");
        } else {
          alertEl.classList.remove("show");
        }

        // Top-5 bars
        const barsContainer = document.getElementById(
          prefix === "upload" ? "top5-bars" : "webcam-top5-bars",
        );
        barsContainer.innerHTML = "";
        data.top5.forEach((item) => {
          const row = document.createElement("div");
          row.className = "bar-row";
          row.innerHTML = `
          <span class="bar-label">${item.emoji} ${item.class}</span>
          <div class="bar-track">
            <div class="bar-fill" data-value="${item.confidence}%"
                 style="width:${Math.max(item.confidence, 2)}%; background: linear-gradient(90deg, ${item.color}, ${item.color}99);">
            </div>
          </div>
        `;
          barsContainer.appendChild(row);
        });

        container.classList.add("show");
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //   WEBCAM MODE
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const video = document.getElementById("webcam-video");
      const canvas = document.getElementById("webcam-canvas");
      const startBtn = document.getElementById("start-webcam-btn");
      const stopBtn = document.getElementById("stop-webcam-btn");
      const liveResult = document.getElementById("live-result");
      let webcamStream = null;
      let webcamInterval = null;

      startBtn.addEventListener("click", startWebcam);
      stopBtn.addEventListener("click", stopWebcam);

      async function startWebcam() {
        try {
          webcamStream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment",
              width: { ideal: 640 },
              height: { ideal: 480 },
            },
          });
          video.srcObject = webcamStream;
          startBtn.style.display = "none";
          stopBtn.style.display = "inline-flex";

          // Start sending frames every 1.5 seconds
          webcamInterval = setInterval(captureAndPredict, 1500);
        } catch (err) {
          alert("Could not access webcam: " + err.message);
        }
      }

      function stopWebcam() {
        if (webcamInterval) clearInterval(webcamInterval);
        if (webcamStream) webcamStream.getTracks().forEach((t) => t.stop());
        video.srcObject = null;
        startBtn.style.display = "inline-flex";
        stopBtn.style.display = "none";
        liveResult.classList.remove("show");
      }

      async function captureAndPredict() {
        if (!webcamStream) return;

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        const base64 = canvas.toDataURL("image/jpeg", 0.8);

        try {
          const res = await fetch("/predict-frame", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: base64 }),
          });
          const data = await res.json();

          // Update live result bar
          document.getElementById("live-emoji").textContent = data.emoji;
          document.getElementById("live-class").textContent = data.prediction;
          document.getElementById("live-class").style.color = data.color;
          document.getElementById("live-conf").textContent =
            `${data.confidence}% confidence`;
          liveResult.classList.add("show");
          liveResult.style.borderColor = data.color + "66";

          // Also update full results card
          showResults(data, "webcam");
        } catch (err) {
          console.error("Frame prediction error:", err);
        }
      }
    </script>
  </body>
</html>
